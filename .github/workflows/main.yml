name: "Create Conan Package"
on: push

jobs:
  build_linux:
    name: "Build Linux"
    uses: Privatehive/conan-workflows/.github/workflows/createPackage.yml@master
    with:
      image: "ghcr.io/tereius/conan-ubuntu:latest"
      runs-on: self-hosted
      conan_remotes: https://conan.privatehive.de/artifactory/api/conan/public-conan
      conan_options: "qt/*:shared=True,qt/*:GUI=True,qt/*:opengl=desktop,qt/*:qtbase=True,qt/*:widgets=True,qt/*:qtdeclarative=True,qt/*:qtsvg=True"

  #build_android:
  #  name: "Build Android"
  #  uses: Privatehive/conan-workflows/.github/workflows/createPackage.yml@master
  #  with:
  #    image: "ghcr.io/tereius/conan-ubuntu:latest"
  #    runs-on: self-hosted
  #    conan_host_profile: "androidArmv8"
  #    conan_remotes: https://conan.privatehive.de/artifactory/api/conan/public-conan
  #    conan_options: "qt/*:shared=True,qt/*:GUI=True,qt/*:qtbase=True,qt/*:widgets=True,qt/*:qtdeclarative=True,qt/*:qtsvg=True"

  build_windows:
    name: "Build Windows"
    uses: Privatehive/conan-workflows/.github/workflows/createPackage.yml@master
    with:
      image: "ghcr.io/tereius/conan-wine:latest"
      runs-on: self-hosted
      conan_host_profile: "windowsMinGW"
      conan_remotes: https://conan.privatehive.de/artifactory/api/conan/public-conan
      conan_options: "qt/*:GUI=True,qt/*:opengl=desktop,qt/*:qtbase=True,qt/*:widgets=True,qt/*:qtdeclarative=True,qt/*:qtsvg=True"

  upload_recipe:
    name: "Finalize"
    needs: [build_linux, build_windows]
    if: ${{ success() }}
    uses: Privatehive/conan-workflows/.github/workflows/uploadRecipe.yml@master
    with:
      conan_upload_remote: https://conan.privatehive.de/artifactory/api/conan/public-conan
    secrets: inherit
